# Логический уровень PostgreSQL 
## Работа с базами данных, пользователями и правами

1. <b>Цель:</b>
    * создание новой базы данных, схемы и таблицы
    * создание роли для чтения данных из созданной схемы созданной базы данных
    * создание роли для чтения и записи из созданной схемы созданной базы данных

1. <b>Описание/Пошаговая инструкция выполнения домашнего задания:</b></br>
    * создайте новый кластер PostgresSQL 14
    * зайдите в созданный кластер под пользователем postgres
    * создайте новую базу данных testdb
    * зайдите в созданную базу данных под пользователем postgres
    * создайте новую схему testnm
    * создайте новую таблицу t1 с одной колонкой c1 типа integer
    * вставьте строку со значением c1=1
    * создайте новую роль readonly
    * дайте новой роли право на подключение к базе данных testdb
    * дайте новой роли право на использование схемы testnm
    * дайте новой роли право на select для всех таблиц схемы testnm
    * создайте пользователя testread с паролем test123
    * дайте роль readonly пользователю testread
    * зайдите под пользователем testread в базу данных testdb
    * сделайте `select * from t1;`
    * <b>получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже).
    напишите что именно произошло в тексте домашнего задания.
    у вас есть идеи почему? ведь права то дали?
    посмотрите на список таблиц.
    подсказка в шпаргалке под пунктом 20.
    а почему так получилось с таблицей? (если делали сами и без шпаргалки то может у вас все нормально)</b>
      > <i>`ERROR:  permission denied for table t1`</br>
      > Получилась так что при создании таблицы я не указал схему и по умолчанию таблица создалась в схеме public (пункты ниже уже подсказывают об этом, можно даже не смотеть в подсказку)</i>
    * вернитесь в базу данных testdb под пользователем postgres
    * удалите таблицу t1
    * создайте ее заново но уже с явным указанием имени схемы testnm
    * вставьте строку со значением c1=1
    * зайдите под пользователем testread в базу данных testdb
    * сделайте `select * from testnm.t1;`
    * <b>получилось? есть идеи почему? если нет - смотрите шпаргалку. как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку</b>
      > <i>`ERROR:  permission denied for table t1`</br>
      > Не получилось, потому что я пересоздал t1, а доступ на чтение для роли не открыл.
      > Выпоплнил такой запрос `grant SELECT on testnm.t1 to readonly;` и предоставил права
      > (PS. Не нравиться мне такая реализация. Если я дал доступ к схеме, то мне не интересно какие там таблицы и не хочется забивать этим голову. Получается, что предоставляется доступ не к схеме, а к каждой таблице находящихся на тот момент в схеме)</i>
    * сделайте `select * from testnm.t1;`
    * <b>получилось? есть идеи почему? если нет - смотрите шпаргалку. как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку</b>
      > <i>Получилось и получил результат</i>
    * сделайте `select * from testnm.t1;`
    * <b>получилось? ура!</b>
      > <i>Получилось еще на прошлом шаге</i>
    * теперь попробуйте выполнить команду `create table t2(c1 integer); insert into t2 values (2);`
    * <b>а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly? есть идеи как убрать эти права? если нет - смотрите шпаргалку. если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что сделали и почему выполнив указанные в ней команды</b>
      > <i>`ERROR:  permission denied for schema public`</br>
      > потому что к public я доступа не давал и к группам create, insert аналогично.
      > Запросил `'search_path = "$user", public` ничего не менял. Предполагаю что по подсказкам у меня должнен быть положительный вывод.
      > выполнил команды по удалению прав на создание к схеме public и на testdb, те что были указаны подсказках</i>
    * теперь попробуйте выполнить команду `create table t3(c1 integer); insert into t2 values (2);`
    * <b>расскажите что получилось и почему</b>
      > <i>`ERROR:  permission denied for schema public` аналогичный результат, потому что доступов нет и не было</i>