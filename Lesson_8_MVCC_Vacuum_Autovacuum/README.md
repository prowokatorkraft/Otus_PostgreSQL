# MVCC, vacuum и autovacuum 
## Настройка autovacuum с учетом особеностей производительности

1. <b>Цель:</b>
    * запустить нагрузочный тест pgbench
    * настроить параметры autovacuum
    * проверить работу autovacuum

1. <b>Описание/Пошаговая инструкция выполнения домашнего задания:</b></br>
    * Создать инстанс ВМ с 2 ядрами и 4 Гб ОЗУ и SSD 10GB
    * Установить на него PostgreSQL 15 с дефолтными настройками
    * Создать БД для тестов: выполнить `pgbench -i postgres`
    * Запустить `pgbench -c8 -P 6 -T 60 -U postgres postgres`
    * Применить параметры настройки PostgreSQL из прикрепленного к материалам занятия файла
    * Протестировать заново
    * <b>Что изменилось и почему?</b>
      > <i>Заметил что цифры стали меньше, скорее из за оптимальной настройки вакума относитенльно виртуальной машины.</i></br>
      > ![Тест](https://github.com/prowokatorkraft/Otus_PostgreSQL/blob/main/Lesson_8_MVCC_Vacuum_Autovacuum/2023-05-01_17h57_09.png)
    * Создать таблицу с текстовым полем и заполнить случайными или сгенерированными данным в размере 1млн строк
    * Посмотреть размер файла с таблицей
    * 5 раз обновить все строчки и добавить к каждой строчке любой символ
    * Посмотреть количество мертвых строчек в таблице и когда последний раз приходил автовакуум
    * Подождать некоторое время, проверяя, пришел ли автовакуум
    * 5 раз обновить все строчки и добавить к каждой строчке любой символ
    * Посмотреть размер файла с таблицей
    * Отключить Автовакуум на конкретной таблице
    * 10 раз обновить все строчки и добавить к каждой строчке любой символ
    * Посмотреть размер файла с таблицей
    * <b>Объясните полученный результат</b>
      > <i>Создал таблицу с данными, которая заняла 35мб, затем изменил 5 раз данные и таблица стала весить 211мб.
      > После отключения автовакума, изменил данные 10 раз и таблица раздулась до 464мб.</i></br>
      > ![Автовакуум](https://github.com/prowokatorkraft/Otus_PostgreSQL/blob/main/Lesson_8_MVCC_Vacuum_Autovacuum/2023-05-01_18h44_03.png)
    * Не забудьте включить автовакуум)
    * Задание со *:
    * Написать анонимную процедуру, в которой в цикле 10 раз обновятся все строчки в искомой таблице.
    * Не забыть вывести номер шага цикла.