# SQL и реляционные СУБД. Введение в PostgreSQL
## Работа с уровнями изоляции транзакции в PostgreSQL

1. <b>Цель:</b>
    * научиться работать с Google Cloud Platform на уровне Google Compute Engine (IaaS)
    * научиться управлять уровнем изолции транзации в PostgreSQL
    * понимать особенность работы уровней read commited и repeatable read

1. <b>Описание/Пошаговая инструкция выполнения домашнего задания:</b></br>

    * создать новый проект в Google Cloud Platform, Яндекс облако или на любых ВМ, докере
    * далее создать инстанс виртуальной машины с дефолтными параметрами
    * добавить свой ssh ключ в metadata ВМ
    * зайти удаленным ssh (первая сессия), не забывайте про ssh-add
    * поставить PostgreSQL
    * зайти вторым ssh (вторая сессия)
    * запустить везде psql из под пользователя postgres
</br></br>
    * выключить `auto commit`
    * сделать в первой сессии новую таблицу и наполнить ее данными `create table persons(id serial, first_name text, second_name text); insert into persons(first_name, second_name) values('ivan', 'ivanov'); insert into persons(first_name, second_name) values('petr', 'petrov'); commit;`
    * посмотреть текущий уровень изоляции: `show transaction isolation level`
    * начать новую транзакцию в обоих сессиях с дефолтным (не меняя) уровнем изоляции
    * в первой сессии добавить новую запись `insert into persons(first_name, second_name) values('sergey', 'sergeev');`
    * сделать `select * from persons` во второй сессии
    * <b>видите ли вы новую запись и если да то почему?</b>
      > <i>Новую запись не вижу, поскольку данная запись представляет собой грязные данные первой транзакции. Грязными они считаются пока не будут зафиксированы первой транзакцией.</i>
    * завершить первую транзакцию - commit;
    * сделать `select * from persons` во второй сессии
    * <b>видите ли вы новую запись и если да то почему?</b>
      > <i>Вижу запись, поскольку данная запись была зафиксирована первой транзакцией</i>
    * завершите транзакцию во второй сессии
    * начать новые но уже repeatable read транзации - `set transaction isolation level repeatable read;`
    * в первой сессии добавить новую запись `insert into persons(first_name, second_name) values('sveta', 'svetova');`
    * сделать `select * from persons` во второй сессии
    * <b>видите ли вы новую запись и если да то почему?</b>
      > <i>Данная запись представляет собой грязные данные первой транзакции и поэтому новую запись не вижу.</i>
    * завершить первую транзакцию - `commit;`
    * сделать `select * from persons` во второй сессии
    * <b>видите ли вы новую запись и если да то почему?</b>
      > <i>Новую запись также не вижу, т.к. данный уровень изоляции во второй транзакции позволяет читать только те данные, которые были получены при первом запросе, исключая аномалию повторного чтения измененных данных другими транзакциями</i>
    * завершить вторую транзакцию
    * сделать `select * from persons` во второй сессии
    * <b>видите ли вы новую запись и если да то почему?</b>
      > <i>Новая вторая транзакция тянет свежие обновленные данные и поэтому вижу запись</i>
